# 微信4.0版本发送消息测试说明

## 📋 测试文件说明

### 1. `test_send_message_quick.py` - 快速测试版（推荐新手）
最简单的测试脚本，适合快速验证功能是否正常。

**使用方法：**
```bash
python test_send_message_quick.py
```

**修改内容：**
- 修改 `friend` 参数为你要测试的好友名称（建议先用"文件传输助手"）
- 修改 `messages` 列表中的消息内容

### 2. `test_send_message_4.0.py` - 完整测试版
包含多个测试场景的完整测试套件。

**使用方法：**
```bash
python test_send_message_4.0.py
```

**测试内容：**
- ✅ 测试1: 给单个好友发送单条消息
- ✅ 测试2: 给单个好友发送多条消息
- ✅ 测试3: 给多个好友发送消息
- ✅ 测试4: 发送长消息（超过2000字自动转txt）
- ✅ 测试5: 使用全局配置发送消息

## ⚙️ 使用前准备

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 确保微信已登录
- 打开PC微信并确保已登录
- 建议在手机端开启"PC端自动登录"功能

### 3. 测试环境
- Windows 10/11
- 微信版本：4.0.6+（推荐4.1.4.10）
- Python 3.x

## 🚀 快速开始

### 最简单的测试
```python
from pyweixin.WeChatAuto import Messages

# 给文件传输助手发送一条消息
Messages.send_messages_to_friend(
    friend="文件传输助手",
    messages=["测试消息"],
    close_weixin=True
)
```

### 发送多条消息
```python
from pyweixin.WeChatAuto import Messages

Messages.send_messages_to_friend(
    friend="文件传输助手",
    messages=[
        "第一条消息",
        "第二条消息",
        "第三条消息"
    ],
    send_delay=0.3,  # 每条消息间隔0.3秒
    close_weixin=True
)
```

### 给多个好友发送消息
```python
from pyweixin.WeChatAuto import Messages

Messages.send_messages_to_friends(
    friends=["好友1", "好友2", "好友3"],
    messages=[
        ["发给好友1的消息"],
        ["发给好友2的消息"],
        ["发给好友3的消息"]
    ],
    close_weixin=True
)
```

## 📝 参数说明

### `send_messages_to_friend()` 参数

| 参数 | 类型 | 说明 | 默认值 |
|------|------|------|--------|
| `friend` | str | 好友或群聊备注名称 | 必填 |
| `messages` | list[str] | 待发送的消息列表 | 必填 |
| `send_delay` | float | 发送单条消息的延迟（秒） | 0.2 |
| `is_maximize` | bool | 微信界面是否全屏 | False |
| `close_weixin` | bool | 任务结束后是否关闭微信 | True |

### 全局配置

可以通过 `GlobalConfig` 设置全局默认值：

```python
from pyweixin.Config import GlobalConfig

# 设置全局配置
GlobalConfig.is_maximize = False
GlobalConfig.send_delay = 0.3
GlobalConfig.close_weixin = True
GlobalConfig.search_pages = 5
```

## ⚠️ 注意事项

1. **好友名称必须准确**
   - 使用好友的备注名称或群聊名称
   - 名称必须与微信中显示的一致
   - 建议先用"文件传输助手"测试

2. **消息内容限制**
   - 单条消息最多2000字
   - 超过2000字会自动转换为txt文件发送
   - 不能发送空消息

3. **测试时不要操作电脑**
   - 测试过程中请勿移动鼠标
   - 请勿操作键盘
   - 避免干扰自动化流程

4. **网络连接**
   - 确保网络连接正常
   - 如果出现网络错误，请检查网络设置

5. **微信版本**
   - 确保使用微信4.0+版本
   - 推荐使用4.1.4.10版本

## 🐛 常见错误

### 1. `NoSuchFriendError` - 未找到好友
**原因：** 好友名称不正确或好友不存在

**解决方法：**
- 检查好友备注名称是否正确
- 确保好友在通讯录中
- 建议先用"文件传输助手"测试

### 2. `NetWorkNotConnectError` - 网络未连接
**原因：** 网络连接异常

**解决方法：**
- 检查网络连接
- 确保微信可以正常联网

### 3. `ScanCodeToLogInError` - 需要扫码登录
**原因：** 微信未登录或需要扫码

**解决方法：**
- 确保微信已登录
- 在手机端开启"PC端自动登录"功能

### 4. `CantSendEmptyMessageError` - 消息为空
**原因：** 消息列表为空或消息内容为空

**解决方法：**
- 确保messages列表不为空
- 确保每条消息都有内容

## 📚 更多示例

### 使用全局配置
```python
from pyweixin.WeChatAuto import Messages
from pyweixin.Config import GlobalConfig

# 设置全局配置
GlobalConfig.send_delay = 0.5
GlobalConfig.close_weixin = False  # 不关闭微信，方便连续操作

# 发送消息（使用全局配置）
Messages.send_messages_to_friend(
    friend="文件传输助手",
    messages=["测试消息"]
)
```

### 连续发送（不关闭微信）
```python
from pyweixin.WeChatAuto import Messages

# 第一次发送（不关闭微信）
Messages.send_messages_to_friend(
    friend="好友1",
    messages=["消息1"],
    close_weixin=False  # 不关闭微信
)

# 第二次发送（继续使用已打开的微信）
Messages.send_messages_to_friend(
    friend="好友2",
    messages=["消息2"],
    close_weixin=True  # 最后关闭微信
)
```

## 🔗 相关资源

- 项目地址: https://github.com/Hello-Mr-Crab/pywechat
- 详细文档: 查看 `Weixin4.0.md`
- 完整功能: 查看 `README.md`

## 💡 提示

- 首次使用建议先用"文件传输助手"测试
- 测试成功后再尝试发送给真实好友
- 建议在测试环境中运行，避免误操作
- 可以设置 `close_weixin=False` 来观察发送过程

